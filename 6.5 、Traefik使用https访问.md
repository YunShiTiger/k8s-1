1.traefik来实现https的访问。
2.配置证书

```bash
openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=wzxmt.com"
```

创建secret

```bash
kubectl create secret tls traefik-cert  --key tls.key --cert tls.crt -n ingress-system
```

3.创建configmap
这里的traefik中配置了把所有http请求全部rewrite为https的规则，并配置相应的证书位置：

```bash
cat << 'EOF' >traefik.toml
insecureSkipVerify = true
defaultEntryPoints = ["http","https"]
[entryPoints]
  [entryPoints.http]
  address = ":80"
    [entryPoints.http.redirect]
    entryPoint = "https"
  [entryPoints.https]
  address = ":443"
    [entryPoints.https.tls]
      [[entryPoints.https.tls.certificates]]
      certFile = "/etc/kubernetes/pki/ca.pem"
      keyFile = "/etc/kubernetes/pki/ca-key.pem"
      #可以多证书配置，需要挂载多个证书
      #[[entryPoints.https.tls.certificates]]
      #certFile = "/ssl/dfb/tls.crt"
      #keyFile = "/ssl/dfb/tls.key"    
EOF
kubectl create configmap traefik-conf --from-file=traefik.toml -n ingress-system

[root@m1 pki]# kubectl get cm -n ingress-system
NAME           DATA   AGE
traefik-conf   1      23s
```
4.部署Traefik，关联创建的secret和configMap，并挂载相对应的主机目录。
备份下原有文件
cp traefik-deployment.yaml traefik-deployment.yaml.bak
添加以下配置
```yaml
...
      hostNetwork: true
      # 挂载 "secret" 与 "configmap" 资源
      volumes:
      - name: ssl
        secret:
          secretName: traefik-cert
      - name: config
        configMap:
          name: traefik-conf
      containers:
      - image: traefik
        name: traefik-ingress-lb
        # 设置挂载点
        volumeMounts:
        - mountPath: "/etc/kubernetes/pki"
          name: "ssl"
        - mountPath: "/config"
          name: "config"
        ports:
...
        args:
        # 添加启动参数 "--configfile=/config/traefik.toml"，注意路径与文件名与 "configmap" 的对应
        - --api
        - --configfile=/config/traefik.toml
....
```
5.使用https访问traefik-dashboard

```yaml
cat << 'EOF' > traefiks-dashboard.yaml
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: traefiks-dashboard
  namespace: ingress-system
spec:
  entryPoints:
    - websecure
  routes:
  - match: Host(`traefik.wzxmt.com`)
    kind: Rule
    services:
    - name: api@internal
      kind: TraefikService
    tls:
    secretName: traefik-cert
EOF
kubectl apply -f traefiks-dashboard.yaml
```
测试访问https://traefik.wzxmt.com,访问成功

