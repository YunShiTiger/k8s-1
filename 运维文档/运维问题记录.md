#### 1、k8s集群环境，docker拉取镜像: Cannot allocate memory

**问题**

测试环境拉取镜像cannot allocate memory

**排查过程**：

进程数并没满，然后排查相关组键问题，k8s采用的二进制部署，因而与docker相关的组件有kubelet与flanld以及docker版本有关，测试发现更换版本并未解决问题；测试发现停掉flanld服务，重启主机，还是不能拉取镜像，关闭kubelet服务，重启主机，发现可以正常拉取镜像，因此排查出kubelet影响了镜像的拉取，经排查相应配置时发现一些久配置（已弃用），怀疑与这些旧配置影响镜像拉取

**解决**

剔除旧配置，重启服务，可以正常拉取。

![](../acess/16293593634202.png)

![image-20210826112838607](../acess/image-20210826112838607.png)

#### 2、非443端口启用https

需要添加以下配置，否则应用访问不了

```
ssl on;
```

#### 3、kubelet报错

**问题**

通过 journalctl -u kubelet -f 命令看kubelet日志,就没有 Orphaned pod found - but volume paths are still present on disk报错

**排查**

通过`journalctl -u kubelet -f`发现一直在报以上错误，从错误信息可以推测出，这台节点存在一个孤立的Pod，并且该Pod挂载了数据卷(volume)，阻碍了Kubelet对孤立的Pod正常回收清理.kubelet 默认把一些数据信息存放在 `/var/lib/kubelet` 目录下，通过 `Pod Id`能查找到pod 挂载的数据。

**解决**

通过查看 `etc-hosts` 文件的 `pod name` 名称，查看集群中是否还有相关实例在运行，如果没有直接删除

或者重启kubelet

